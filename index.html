<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAP'S Restaurant Ordering System</title>
<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#e63946;color:#fff;padding:15px;text-align:center;font-size:22px}
nav{display:flex;background:#333}
nav button{flex:1;padding:12px;border:none;background:#333;color:#fff;cursor:pointer}
nav button:hover{background:#555}
.page{display:none;padding:20px}
.active{display:block}
.card{background:#fff;padding:15px;margin:10px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
button.primary{background:#e63946;color:#fff;border:none;padding:10px 15px;border-radius:6px;cursor:pointer}
input,select{width:100%;padding:8px;margin:6px 0}
.badge{padding:3px 8px;border-radius:6px;color:#fff;font-size:12px}
.pending{background:#f4a261}
.paid{background:#2a9d8f}
.status{background:#457b9d}
img.proof{width:120px;border-radius:6px}
.notice{background:#fffae6;padding:10px;text-align:center}
</style>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#e63946">
</head>
<body>
<header>NAP'S Restaurant</header>
<nav>
<button onclick="showPage('menu')">Menu</button>
<button onclick="showPage('cart')">Cart</button>
<button onclick="showPage('track')">Track</button>
<button onclick="showPage('admin')">Admin</button>
</nav>

<div id="notice"></div>

<!-- MENU -->
<div id="menu" class="page active">
<h2>Menu</h2>
<div id="menuList"></div>
</div>

<!-- CART -->
<div id="cart" class="page">
<h2>Your Cart</h2>
<div id="cartList"></div>
<p><b>Total: ‚Ç±<span id="total">0</span></b></p>

<label>Customer Phone</label>
<input id="phone" placeholder="09xxxxxxxxx">

<label>Delivery Address</label>
<input id="address" placeholder="House / Street / Barangay">

<label>Payment</label>
<select id="payment" onchange="toggleProof()">
<option value="">Select</option>
<option>GCash</option>
<option>COD</option>
</select>

<div id="gcashBox" style="display:none">
<p>Send payment to: <b>09540891929</b> (Snooky D.)</p>
<label>Upload GCash Proof</label>
<input type="file" id="proof" accept="image/*">
</div>

<button class="primary" onclick="placeOrder()">Place Order</button>
</div>

<!-- TRACK -->
<div id="track" class="page">
<h2>Track Order</h2>
<input id="trackId" placeholder="Enter order id">
<button onclick="trackOrder()">Track</button>
<div id="trackResult"></div>
</div>

<!-- ADMIN -->
<div id="admin" class="page">
<h2>Admin Panel</h2>
<div id="adminOrders"></div>
</div>

<script>
const menu=[
{name:'Burger',price:120},
{name:'Fries',price:70},
{name:'Fried Chicken',price:150},
{name:'Spaghetti',price:130}
];
let cart=[];

function showPage(id){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.getElementById(id).classList.add('active');
if(id==='admin')renderAdmin();
}

function renderMenu(){
menuList.innerHTML='';
menu.forEach((m,i)=>{
menuList.innerHTML+=`<div class='card'>${m.name} - ‚Ç±${m.price}
<button class='primary' onclick='addCart(${i})'>Add</button></div>`;
});
}

function addCart(i){
let item=cart.find(c=>c.name===menu[i].name);
if(item)item.qty++;
else cart.push({...menu[i],qty:1});
renderCart();
}

function renderCart(){
cartList.innerHTML='';
let t=0;
cart.forEach(c=>{
t+=c.price*c.qty;
cartList.innerHTML+=`<div>${c.name} x${c.qty}</div>`;
});
total.innerText=t;
}

function toggleProof(){
gcashBox.style.display=payment.value==='GCash'?'block':'none';
}

function placeOrder(){
if(!cart.length)return alert('Cart empty');
if(!phone.value||!address.value)return alert('Enter details');
if(payment.value==='GCash'&&!proof.files.length)return alert('Upload proof');

let reader=new FileReader();
reader.onload=function(){
saveOrder(reader.result);
};
if(proof.files[0])reader.readAsDataURL(proof.files[0]);
else saveOrder(null);
}

function saveOrder(img){
let orders=JSON.parse(localStorage.getItem('orders')||'[]');
let id=Date.now();
orders.push({id,items:cart,total:total.innerText,phone:phone.value,address:address.value,payment:payment.value,proof:img,status:'Preparing',paymentStatus:payment.value==='GCash'?'Pending':'Paid'});
localStorage.setItem('orders',JSON.stringify(orders));

if(img)notice.innerHTML="<div class='notice'>üîî New GCash proof uploaded</div>";

alert('Order placed! ID:'+id);
cart=[];renderCart();
}

function trackOrder(){
let orders=JSON.parse(localStorage.getItem('orders')||'[]');
let o=orders.find(o=>o.id==trackId.value);
if(!o)return trackResult.innerHTML='Not found';
trackResult.innerHTML=`Status: <span class='badge status'>${o.status}</span>`;
}

function renderAdmin(){
let orders=JSON.parse(localStorage.getItem('orders')||'[]');
adminOrders.innerHTML='';
orders.reverse().forEach(o=>{
adminOrders.innerHTML+=`<div class='card'>
<b>#${o.id}</b><br>
${o.items.map(i=>i.name+' x'+i.qty).join('<br>')}<br>
Payment: ${o.payment} <span class='badge ${o.paymentStatus==='Paid'?'paid':'pending'}'>${o.paymentStatus}</span><br>
Status: ${o.status}<br>
${o.proof?`<img src='${o.proof}' class='proof'><br>`:''}
<button onclick='markPaid(${o.id})'>Mark Paid</button>
<button onclick='setStatus(${o.id},"Preparing")'>Preparing</button>
<button onclick='setStatus(${o.id},"Out for delivery")'>Out</button>
<button onclick='setStatus(${o.id},"Delivered")'>Done</button>
<button onclick='printReceipt(${o.id})'>Print</button>
</div>`;
});
}

function markPaid(id){
let orders=JSON.parse(localStorage.getItem('orders')||'[]');
let o=orders.find(o=>o.id===id);
if(o){o.paymentStatus='Paid';localStorage.setItem('orders',JSON.stringify(orders));alert('SMS: Payment verified for '+id);renderAdmin();}
}

function setStatus(id,s){
let orders=JSON.parse(localStorage.getItem('orders')||'[]');
let o=orders.find(o=>o.id===id);
if(o){o.status=s;localStorage.setItem('orders',JSON.stringify(orders));renderAdmin();}
}

function printReceipt(id){
let orders=JSON.parse(localStorage.getItem('orders')||'[]');
let o=orders.find(o=>o.id===id);
let w=window.open('','','width=300');
w.document.write(`<body style='font-family:monospace;width:280px'>
<h3 style='text-align:center'>NAP'S Restaurant</h3>
Order #${o.id}<hr>
${o.items.map(i=>i.name+' x'+i.qty+' ‚Ç±'+i.price*i.qty).join('<br>')}
<hr>Total ‚Ç±${o.total}<br>${o.payment}<hr>Thank you</body>`);
w.print();
w.close();
}

renderMenu();
// ‚≠ê Register service worker for PWA
if('serviceWorker' in navigator){
 navigator.serviceWorker.register('sw.js');
}
</script>

<!-- ‚≠ê Install App Button -->
<button id="installBtn" style="position:fixed;bottom:15px;right:15px;padding:12px;border:none;border-radius:50%;background:#e63946;color:#fff;font-size:18px">üì±</button>

<script>
let deferredPrompt;
window.addEventListener('beforeinstallprompt',e=>{
 e.preventDefault();
 deferredPrompt=e;
});
installBtn.onclick=async()=>{
 if(!deferredPrompt)return alert('Install not available');
 deferredPrompt.prompt();
};
</script>
</body>
</html>
